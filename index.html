<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Development Zones Map</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" />
  <style>
    html, body, #map {
      height: 100%;
      margin: 0;
      padding: 0;
    }
    .legend {
      position: fixed;
      bottom: 50px;
      left: 50px;
      background: white;
      padding: 10px;
      border-radius: 18px;
      font-size: 14px;
      z-index: 9999;
      box-shadow: 0 0 5px rgba(0,0,0,0.3);
    }
    .legend i {
      width: 10px;
      height: 10px;
      display: inline-block;
      margin-right: 5px;
    }

    /* üîß –£–±–∏—Ä–∞–µ–º —Å–∏–Ω—é—é —Ä–∞–º–∫—É –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –æ–±—ä–µ–∫—Ç */
    path.leaflet-interactive:focus {
      outline: none !important;
    }
  </style>
</head>
<body>

<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chroma-js@2.4.2/chroma.min.js"></script>
<script>
// –°–æ–∑–¥–∞–µ–º –∫–∞—Ä—Ç—É
const map = L.map('map').setView([32.08, 34.78], 12);

L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
  attribution: '&copy; OpenStreetMap & CartoDB'
}).addTo(map);

// –ó–∞–≥—Ä—É–∑–∫–∞ GeoJSON –∏ —Ä–µ–Ω–¥–µ—Ä
fetch('development_zones_and_nodes.geojson')
  .then(res => res.json())
  .then(data => {
    // –°–æ–±–∏—Ä–∞–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è Zone_Name
    const zoneSet = new Set();
    data.features.forEach(f => {
      const val = f.properties.Zone_Name?.trim();
      if (val) zoneSet.add(val);
    });
    const uniqueZones = Array.from(zoneSet).sort();

    // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ü–≤–µ—Ç–æ–≤—É—é –ø–∞–ª–∏—Ç—Ä—É
    const palette = chroma.scale('Paired').mode('lch').colors(uniqueZones.length);
    const colorMap = {};
    uniqueZones.forEach((zone, i) => {
      colorMap[zone] = palette[i];
    });

    // –°—Ç–∏–ª—å –≥–µ–æ–º–µ—Ç—Ä–∏–π
    function style(feature) {
      const zone = feature.properties.Zone_Name?.trim();
      return {
        fillColor: colorMap[zone] || 'gray',
        weight: 0.5,
        opacity: 1,
        color: 'white',
        fillOpacity: 0.7
      };
    }

    const layer = L.geoJson(data, {
      style: style,
      onEachFeature: (feature, layer) => {
        const zone = feature.properties.Zone_Name || "Unknown";
        const notes = feature.properties.notes || "No data";

        layer.bindTooltip(zone, { sticky: true });
        layer.bindPopup(`<b>Notes:</b> ${notes}`);

        // –£–±–∏—Ä–∞–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –ø–æ–¥—Å–≤–µ—Ç–∫—É –ø—Ä–∏ –∫–ª–∏–∫–µ
        layer.on('mouseover', function () {
          this.setStyle({ weight: 1.5 });
        });
        layer.on('mouseout', function () {
          this.setStyle(style(feature));
        });
        layer.on('click', function (e) {
          e.originalEvent.preventDefault();
          e.originalEvent.stopPropagation();
        });
      }
    }).addTo(map);

    map.fitBounds(layer.getBounds());

    // –õ–µ–≥–µ–Ω–¥–∞
    const legend = L.control({ position: "bottomleft" });
    legend.onAdd = function () {
      const div = L.DomUtil.create("div", "legend");
      div.innerHTML = "<b>Zone Type Legend</b><br>" + uniqueZones.map(
        zone => `<i style="background:${colorMap[zone]}"></i>${zone}`
      ).join("<br>");
      return div;
    };
    legend.addTo(map);
  });
</script>

</body>
</html>
